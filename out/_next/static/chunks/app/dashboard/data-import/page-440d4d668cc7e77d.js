(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9605],{2056:function(e,t,r){Promise.resolve().then(r.bind(r,5e3))},5e3:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var n=r(7437),a=r(2265),s=r(5452),i=r.n(s),l=r(4415),o=r(6262),c=r(9820),d=r(2381),u=r(9174),m=r(5526);class h{async init(){if(!this.organizationId){let{data:e}=await (0,m.getCurrentUserOrganization)();this.organizationId=(null==e?void 0:e.id)||null}}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!t.skipOrgValidation&&(await this.init(),!this.organizationId))return{success:!1,error:"No organization context available"};let r="".concat(this.baseUrl).concat(e),n={"Content-Type":"application/json",...t.headers};this.organizationId&&!t.skipOrgValidation&&(n["X-Organization-ID"]=this.organizationId);let a={method:t.method||"GET",headers:n};t.body&&"GET"!==t.method&&(t.body instanceof FormData?(delete n["Content-Type"],a.body=t.body):a.body=JSON.stringify(t.body));let s=await fetch(r,a);if(!s.ok){let e=await s.text();return{success:!1,error:"API Error ".concat(s.status,": ").concat(e)}}let i=await s.json();return{success:!0,data:i}}catch(e){return console.error("API request failed:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async get(e,t){return this.request(e,{...t,method:"GET"})}async post(e,t,r){return this.request(e,{...r,method:"POST",body:t})}async put(e,t,r){return this.request(e,{...r,method:"PUT",body:t})}async patch(e,t,r){return this.request(e,{...r,method:"PATCH",body:t})}async delete(e,t){return this.request(e,{...t,method:"DELETE"})}async uploadFile(e,t,r){let n=new FormData;return n.append("file",t),r&&Object.entries(r).forEach(e=>{let[t,r]=e;n.append(t,"string"==typeof r?r:JSON.stringify(r))}),this.request(e,{method:"POST",body:n})}resetOrganization(){this.organizationId=null}getCurrentOrganizationId(){return this.organizationId}constructor(e="/api"){this.organizationId=null,this.baseUrl=e}}let g=new h;function x(){let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(!0),[s,i]=(0,a.useState)(null),l=async()=>{try{n(!0),i(null);let{data:e,error:r}=await (0,m.getCurrentUserOrganization)();if(r){i("string"==typeof r?r:"Failed to load organization");return}t(e),e&&await g.init()}catch(e){console.error("Error loading organization:",e),i(e instanceof Error?e.message:"Unknown error")}finally{n(!1)}};return(0,a.useEffect)(()=>{l()},[]),{organization:e,loading:r,error:s,refreshOrganization:l}}var f=r(7689),p=r(1649),b=r(5302),v=r(1723),j=r(2489),y=r(9397),N=r(91),w=r(2252),D=r(6221);let z=[{id:1,name:"Kundendaten_Januar.csv",date:"2024-01-20",status:"success",records:1234,type:"CSV"},{id:2,name:"Newsletter_Abonnenten.xlsx",date:"2024-01-18",status:"processing",records:892,type:"Excel"},{id:3,name:"API_Sync_Shopify",date:"2024-01-15",status:"success",records:456,type:"API"}];function S(){let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)([]),[h,S]=(0,a.useState)({}),[E,I]=(0,a.useState)(!1),k=(0,a.useRef)(null),{organization:O,loading:Z}=x(),{uploadFile:C,uploading:A,error:R}=function(){let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)(null),{organization:s}=x();return{uploadFile:async(e,r,a)=>{if(!s)return{success:!1,error:"No organization context available"};try{t(!0),n(null);let s=await g.uploadFile(e,r,a);return s.success||n(s.error||"Upload failed"),s}catch(t){let e=t instanceof Error?t.message:"Upload failed";return n(e),{success:!1,error:e}}finally{t(!1)}},uploading:e,error:r}}();console.log("Organization context:",{organization:O,orgLoading:Z,uploadFile:C,fileUploading:A,uploadError:R});let F=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?t(!0):"dragleave"===e.type&&t(!1)},G=e=>{let t=["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],r=e.filter(e=>t.includes(e.type)||e.name.toLowerCase().endsWith(".csv")||e.name.toLowerCase().endsWith(".xlsx")||e.name.toLowerCase().endsWith(".xls"));r.length!==e.length&&alert("Nur CSV und Excel-Dateien sind erlaubt."),s(e=>[...e,...r])},P=async()=>{if(0===r.length){alert("Bitte w\xe4hlen Sie zuerst Dateien aus.");return}I(!0);let e=0,t=0;for(let n of r)try{await U(n),e++}catch(e){t++,console.error("Failed to process ".concat(n.name,":"),e)}I(!1),e>0&&0===t?alert("\uD83C\uDF89 Alle ".concat(e," Datei(en) erfolgreich verarbeitet! Die Daten sind jetzt in Ihrer Datenbank verf\xfcgbar.")):e>0&&t>0?alert("⚠️ ".concat(e," Datei(en) erfolgreich verarbeitet, ").concat(t," Datei(en) fehlgeschlagen.")):alert("❌ Alle ".concat(t," Datei(en) konnten nicht verarbeitet werden.")),e>0&&(s([]),S({}))},U=async e=>new Promise((t,r)=>{let n=new FileReader;n.onload=async n=>{try{var a;let s=null===(a=n.target)||void 0===a?void 0:a.result;S(t=>({...t,[e.name]:10})),i().parse(s,{header:!0,skipEmptyLines:!0,complete:async n=>{try{let a=n.data;S(t=>({...t,[e.name]:30}));let s=a.map(e=>{let t=e.email||e.Email||e.EMAIL||e["E-Mail"]||e.mail,r=e.first_name||e.First_Name||e.firstname||e.Vorname||e["First Name"],n=e.last_name||e.Last_Name||e.lastname||e.Nachname||e["Last Name"],a=e.company||e.Company||e.Unternehmen||e.Firma,s=e.phone||e.Phone||e.Telefon||e.Tel||e["Phone Number"];return t?{customer_type:(null==a?void 0:a.trim())?"company":"person",email:t.trim(),first_name:(null==r?void 0:r.trim())||void 0,last_name:(null==n?void 0:n.trim())||void 0,company_name:(null==a?void 0:a.trim())||void 0,phone:(null==s?void 0:s.trim())||void 0}:null}).filter(e=>null!==e);if(console.log("Parsed ".concat(s.length," customers from ").concat(e.name)),S(t=>({...t,[e.name]:60})),s.length>0){let{data:t,error:n}=await (0,m.LQ)(s);if(n){console.error("Database error:",n);let t="string"==typeof n?n:n.message||"Unbekannter Fehler";alert("Fehler beim Speichern der Daten aus ".concat(e.name,": ").concat(t)),S(t=>({...t,[e.name]:0})),r(n);return}console.log("Successfully inserted ".concat((null==t?void 0:t.length)||s.length," customers")),S(t=>({...t,[e.name]:100})),setTimeout(()=>{alert("✅ ".concat(e.name,": ").concat(s.length," Kundendaten erfolgreich importiert!"))},500)}else alert("⚠️ ".concat(e.name,": Keine g\xfcltigen Kundendaten gefunden. Stellen Sie sicher, dass die Datei eine 'email' Spalte enth\xe4lt.")),S(t=>({...t,[e.name]:0}));t()}catch(t){console.error("Processing error:",t),alert("Fehler beim Verarbeiten von ".concat(e.name,": ").concat(t)),S(t=>({...t,[e.name]:0})),r(t)}},error:t=>{console.error("CSV parsing error:",t),alert("Fehler beim Lesen der CSV-Datei ".concat(e.name,": ").concat(t.message)),S(t=>({...t,[e.name]:0})),r(t)}})}catch(t){console.error("File reading error:",t),alert("Fehler beim Lesen der Datei ".concat(e.name)),S(t=>({...t,[e.name]:0})),r(t)}},n.onerror=()=>{alert("Fehler beim Lesen der Datei ".concat(e.name)),S(t=>({...t,[e.name]:0})),r(Error("File reading failed"))},n.readAsText(e)}),L=e=>{s(t=>t.filter(t=>t.name!==e)),S(t=>{let r={...t};return delete r[e],r})},_=()=>{var e;null===(e=k.current)||void 0===e||e.click()};return(0,n.jsx)(o.Z,{children:(0,n.jsx)(l.Z,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Daten hinzuf\xfcgen"}),(0,n.jsx)("p",{className:"text-gray-600 mt-1",children:"Importieren Sie neue Daten in Ihr CRM-System"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,n.jsxs)(c.Zb,{className:"hover:shadow-lg transition-shadow",children:[(0,n.jsxs)(c.Ol,{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)(f.Z,{className:"h-6 w-6 text-blue-600"})}),(0,n.jsx)(c.ll,{className:"text-lg",children:"CSV/Excel Import"}),(0,n.jsx)(c.SZ,{children:"Laden Sie CSV oder Excel-Dateien hoch"})]}),(0,n.jsxs)(c.aY,{className:"space-y-4",children:[(0,n.jsx)("input",{ref:k,type:"file",multiple:!0,accept:".csv,.xlsx,.xls",onChange:e=>{let t=e.target.files;t&&G(Array.from(t))},className:"hidden"}),(0,n.jsxs)("div",{onDragEnter:F,onDragLeave:F,onDragOver:F,onDrop:e=>{e.preventDefault(),e.stopPropagation(),t(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&G(Array.from(e.dataTransfer.files))},className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer ".concat(e?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400"),onClick:_,children:[(0,n.jsx)(f.Z,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:r.length>0?"Weitere Dateien hinzuf\xfcgen":"Dateien hier ablegen oder klicken zum Ausw\xe4hlen"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"CSV, XLS, XLSX (max. 10MB)"})]}),r.length>0&&(0,n.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:r.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,n.jsx)(p.Z,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("span",{className:"text-sm truncate block",title:e.name,children:e.name}),(0,n.jsxs)("span",{className:"text-xs text-gray-500",children:[(e.size/1024).toFixed(1)," KB • Bereit zur Verarbeitung"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[void 0!==h[e.name]&&h[e.name]<100&&(0,n.jsxs)("div",{className:"text-xs text-blue-600 font-medium",children:[Math.round(h[e.name]),"%"]}),100===h[e.name]&&(0,n.jsx)(b.Z,{className:"h-4 w-4 text-green-600"}),!h[e.name]&&(0,n.jsx)(v.Z,{className:"h-4 w-4 text-gray-400"}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),L(e.name)},className:"text-gray-400 hover:text-red-500 transition-colors",disabled:E,children:(0,n.jsx)(j.Z,{className:"h-4 w-4"})})]})]},t))}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(d.z,{onClick:r.length>0?P:_,className:"w-full",disabled:E,variant:r.length>0?"default":"outline",children:[(0,n.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),E?"Wird verarbeitet...":r.length>0?"".concat(r.length," Datei(en) verarbeiten"):"Dateien ausw\xe4hlen"]}),r.length>0&&!E&&(0,n.jsxs)(d.z,{onClick:_,variant:"outline",className:"w-full",children:[(0,n.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Weitere Dateien hinzuf\xfcgen"]})]})]})]}),(0,n.jsxs)(c.Zb,{className:"hover:shadow-lg transition-shadow cursor-pointer border-2 border-dashed border-gray-300 hover:border-green-500",children:[(0,n.jsxs)(c.Ol,{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)(N.Z,{className:"h-6 w-6 text-green-600"})}),(0,n.jsx)(c.ll,{className:"text-lg",children:"API Integration"}),(0,n.jsx)(c.SZ,{children:"Verbinden Sie externe Systeme \xfcber API"})]}),(0,n.jsx)(c.aY,{className:"text-center",children:(0,n.jsxs)(d.z,{variant:"outline",className:"w-full",children:[(0,n.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"API einrichten"]})})]}),(0,n.jsxs)(c.Zb,{className:"hover:shadow-lg transition-shadow cursor-pointer border-2 border-dashed border-gray-300 hover:border-purple-500",children:[(0,n.jsxs)(c.Ol,{className:"text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)(y.Z,{className:"h-6 w-6 text-purple-600"})}),(0,n.jsx)(c.ll,{className:"text-lg",children:"Manueller Import"}),(0,n.jsx)(c.SZ,{children:"Daten manuell eingeben oder kopieren"})]}),(0,n.jsx)(c.aY,{className:"text-center",children:(0,n.jsxs)(d.z,{variant:"outline",className:"w-full",children:[(0,n.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),"Manuell hinzuf\xfcgen"]})})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(v.Z,{className:"h-5 w-5"}),"Letzte Importe"]}),(0,n.jsx)(c.SZ,{children:"\xdcbersicht \xfcber Ihre neuesten Datenimporte"})]}),(0,n.jsx)(c.aY,{className:"space-y-4",children:z.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("div",{className:"p-2 rounded-full ".concat("success"===e.status?"bg-green-100 text-green-600":"processing"===e.status?"bg-yellow-100 text-yellow-600":"bg-red-100 text-red-600"),children:["success"===e.status&&(0,n.jsx)(b.Z,{className:"h-4 w-4"}),"processing"===e.status&&(0,n.jsx)(v.Z,{className:"h-4 w-4"}),"error"===e.status&&(0,n.jsx)(w.Z,{className:"h-4 w-4"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"font-medium text-sm",children:e.name}),(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:[e.records.toLocaleString()," Datens\xe4tze • ",e.date]})]})]}),(0,n.jsx)(u.C,{variant:"success"===e.status?"default":"processing"===e.status?"secondary":"destructive",children:e.type})]},e.id))})]}),(0,n.jsxs)(c.Zb,{children:[(0,n.jsxs)(c.Ol,{children:[(0,n.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(D.Z,{className:"h-5 w-5"}),"Import-Statistiken"]}),(0,n.jsx)(c.SZ,{children:"\xdcberblick \xfcber Ihre Import-Performance"})]}),(0,n.jsxs)(c.aY,{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:45}),(0,n.jsx)("div",{className:"text-sm text-blue-600",children:"Gesamt Importe"})]}),(0,n.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-900",children:41}),(0,n.jsx)("div",{className:"text-sm text-green-600",children:"Erfolgreich"})]})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-sm font-medium",children:"Erfolgsrate"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:["91.1","%"]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat(91.11111111111111,"%")}})})]}),(0,n.jsxs)("div",{className:"pt-4 border-t",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"font-medium",children:"Datens\xe4tze importiert"}),(0,n.jsx)("span",{className:"text-lg font-bold",children:28750..toLocaleString()})]}),(0,n.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Letzter Import: vor ","2 Stunden"]})]})]})]})]})]})})})}},6262:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(7437),a=r(7182),s=r(9376),i=r(2265);function l(e){let{children:t}=e,{user:r,loading:l}=(0,a.a)(),o=(0,s.useRouter)(),[c,d]=(0,i.useState)(null),[u,m]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(()=>{if(l){console.log("\uD83D\uDEE1️ [ORG GUARD] Auth still loading, waiting...");return}if(!r){console.log("❌ [ORG GUARD] No user found, redirecting to login"),o.push("/login");return}try{var e,t;console.log("\uD83D\uDEE1️ [ORG GUARD] Checking organization for user:",r.email),console.log("\uD83D\uDEE1️ [ORG GUARD] User object:",{id:r.id,email:r.email,role:r.role,organizationId:r.organizationId,organization:r.organization});let n="super_admin"===r.role||r.organizationId&&(null===(e=r.organization)||void 0===e?void 0:e.id);if(console.log("\uD83D\uDEE1️ [ORG GUARD] Organization check result:",{isSuperAdmin:"super_admin"===r.role,hasOrganizationId:!!r.organizationId,hasOrganizationObject:!!(null===(t=r.organization)||void 0===t?void 0:t.id),finalResult:n}),!n){console.log("❌ [ORG GUARD] No organization access, redirecting to organization-required"),o.push("/organization-required");return}console.log("✅ [ORG GUARD] Organization check passed, allowing access"),d(!0)}catch(e){console.error("❌ [ORG GUARD] Error checking organization:",e),o.push("/organization-required")}finally{console.log("\uD83D\uDEE1️ [ORG GUARD] Check complete, setting checking to false"),m(!1)}})()},[r,l,o]),l||u)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):c?(0,n.jsx)(n.Fragment,{children:t}):null}},2381:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(7437),a=r(2265),s=r(7053),i=r(535),l=r(3448);let o=(0,i.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(o({variant:a,size:i,className:r})),ref:t,...d})});c.displayName="Button"}},function(e){e.O(0,[1216,7182,4415,1744],function(){return e(e.s=2056)}),_N_E=e.O()}]);